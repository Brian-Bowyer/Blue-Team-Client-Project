<html>
<head>
	<!-- Credit to Shanimal on StackExchange for template code -->
	<title>Edit Profile</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="themes/theme.min.css" />
  <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" />

	<!-- Install jQuery and underscore -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
	<script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
	<script src="https://www.parsecdn.com/js/parse-1.3.1.min.js"></script>
	
	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCpMZQh33v3B9AuHlqqH8ubLqhpIpxWwWw"></script>

</head>

<body>
	<div id="home" data-role="page" data-position="fixed" data-theme="a" class="type-interior ui-page ui-body-c ui-page-header-fixed ui-page-footer-fixed ui-page-active">
		<div data-role="header" data-position="fixed" data-theme="a" class="ui-header ui-bar-a ui-header-fixed slidedown" role="banner" style="height:41px;" align="center" id="headerbut">
			<img src="images/coworking.png" height="25" width="21" style="margin-top:6px" ></img>Collisions!
		</div>
		<div class="ui-body ui-body-c">
		<div data-role="fieldcontain" class="ui-field-contain ui-body ui-br">
			<label for="Name" >Name</label>
			<input type="text" id="Name" placeholder="Jane Doe" class="ui-input-text ui-body-c ui-corner-all ui-shadow-inset">
		</div>
		
		<div data-role="fieldcontain" class="ui-field-contain ui-body ui-br">
			<label for="Photo">Photo</label>
			<input type="file" data-theme="a" id="Photo" class="ui-input-text ui-body-c ui-corner-all ui-shadow-inset">
		</div>
		
		<div data-role="fieldcontain" class="ui-field-contain ui-body ui-br" style="height: 60px;">
			<button type="submit" class="ui-btn ui-btn-a ui-btn-left ui-corner-all ui-shadow ui-body-c" id="submit">Submit</button>
		</div>
		<br>
		</div>
		
		<div class="footer" data-role="footer" data-position="fixed" data-theme="a" id="footer">
			<div data-role="controlgroup" data-type="horizontal" id="footerbut">
		</div>
	</div>
	
	<style>
		label {
			font-size: 2em;
		}
		.form-control {
			height: auto;
			font-size: 2em;
		}
	</style>


	<script>	
		Parse.initialize("GI4coBdWVBWk8CexD33M9SD0GjHRTTq5jo1GnUbb", "r4yKyt6O5KiJhtMVfXraqoNZqee5JjiIBFH1fyIk");

		var user = Parse.User.current();
		var un;
		if (user) {
			un = user.attributes.username;

			$("#username").html("<button onclick=\"Parse.User.logOut();location.reload();\" class =\"btn btn-primary btn-lg\"><span class = \"buttontext\">Log Out</span></button>");
			
			$('#headerbut').html("<a data-role=\"button\" onclick=\"Redirect()\" id=\"NewData\" class=\"ui-btn ui-btn-left ui-corner-all ui-shadow ui-btn-a \">Cancel</a>" 
				+ "<img src=\"images/coworking.png\" height=\"25\" width=\"21\" style=\"margin-top:6px\"></img>Collisions!" 
				+ "<a id=\"LogoutBut\" data-role=\"button\" onclick=\"logOut()\" class=\"ui-btn ui-btn-right ui-corner-all ui-shadow ui-btn-a \">Log Out</a>");
		} else {
			//un = "none";
			Redirect();
			//document.getElementById('picture2').setAttribute('src',"https://truonex-static.s3.amazonaws.com/images/fallback/profile_avatar_default.png");
			//$("#username").html("<a href = \"login.html\"><button class =\"btn btn-primary btn-lg\"><span class = \"buttontext\">Log In</span></button></a>");
		}

		function Redirect() {
      window.location = "./index.html";
    }


		$('#submit').click(function () {
			var un = user.attributes.username;
            var n = $("#Name").val();
                var fileUploadControl = $("#Photo")[0];
                if (fileUploadControl.files.length > 0) {
                    var file = fileUploadControl.files[0];
                    var name = file.name;
                    var parseFile = new Parse.File(name, file);

   //put this inside if {
                    parseFile.save().then(function() {
   // The file has been saved to Parse.
                     }, function(error) {
   // The file either could not be read, or could not be saved to Parse.
                    });

                    //user = Parse.User.current();
                    user.set("photo", parseFile);
                    user.set("name", n);
                    user.save(null, {
                    success: function(user) {
                        // Execute any logic that should take place after the object is saved.
                        Redirect();
                                            },
                    error: function(user, error) {
                        // Execute any logic that should take place if the save fails.
                        // error is a Parse.Error with an error code and message.
                        alert('Failed to create new object, with error code: ' + error.id);
                    }
                });                
                }

		});

	</script>

</body>
</html>