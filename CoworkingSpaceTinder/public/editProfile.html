<html>
<head>
	<!-- Credit to Shanimal on StackExchange for template code -->
	<title>Edit Profile</title>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="css/Stylesheet.css">

	<!-- Install jQuery and underscore -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
	<script src="http://documentcloud.github.com/underscore/underscore-min.js"></script>
	<script src="https://www.parsecdn.com/js/parse-1.2.18.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
</head>

<body>
	<div class = "header shadow">
		<div class = "row row-xs-height">
			<div class = "col-xs-3 col-xs-height col-bottom">
				<a href = "./index.html"><button class ="btn btn-primary btn-lg"><span class = "buttontext">Cancel</span></button></a>
			</div>
			<div class = "col-xs-6 col-xs-height col-bottom">
				<center><span style="font-size: 6em">Collisions</span></center>
			</div>
			<div class = "col-xs-1 col-xs-height col-bottom">
				<div class = "thumbnail" id = "picture"><img id='picture2' width="100" height="75"></div>
			</div>
			<div class = "col-xs-2 col-xs-height col-bottom">
				<div class = "text-right" id = "username"></div>
			</div>
		</div>
	</div>
	<div style = "margin: 0 30px 0 30px" class = "container-fluid filters">

		<div class="form-group">
			<label for="FirstName">Name</label>
			<input type="text" class="form-control" id="Name" placeholder="Jane Doe">
		</div>
		
		<div class="form-group">
			<label for="Photo">Photo</label>
			<input type="file" class="form-control" id="Photo">
		</div>
		<br>
		<div>
			<button type="submit" class="btn btn-primary btn-lg btn-block" id="submit"><span class = "buttontext">Submit</span></button>
		</div>
		<br>
	</div>
	<style>
		label {
			font-size: 3em;
		}
		.form-control {
			height: auto;
			font-size: 3em;
		}
	</style>

	<script>	
		Parse.initialize("GI4coBdWVBWk8CexD33M9SD0GjHRTTq5jo1GnUbb", "r4yKyt6O5KiJhtMVfXraqoNZqee5JjiIBFH1fyIk");

		var user = Parse.User.current();
		var un;
		if (user) {
			un = user.attributes.username;
			if (user.attributes.photo) {			
				document.getElementById('picture2').setAttribute('src',user.attributes.photo.url());
			} else {
				document.getElementById('picture2').setAttribute('src',"https://truonex-static.s3.amazonaws.com/images/fallback/profile_avatar_default.png");
			}
			$("#username").html("<button onclick=\"Parse.User.logOut();location.reload();\" class =\"btn btn-primary btn-lg\"><span class = \"buttontext\">Log Out</span></button>");
		} else {
			//un = "none";
			Redirect();
			//document.getElementById('picture2').setAttribute('src',"https://truonex-static.s3.amazonaws.com/images/fallback/profile_avatar_default.png");
			//$("#username").html("<a href = \"login.html\"><button class =\"btn btn-primary btn-lg\"><span class = \"buttontext\">Log In</span></button></a>");
		}

		function Redirect() {
      window.location = "./index.html";
    }


		$('#submit').click(function () {
			var un = user.attributes.username;
            var n = $("#Name").val();
                var fileUploadControl = $("#Photo")[0];
                if (fileUploadControl.files.length > 0) {
                    var file = fileUploadControl.files[0];
                    var name = file.name;
                    var parseFile = new Parse.File(name, file);

   //put this inside if {
                    parseFile.save().then(function() {
   // The file has been saved to Parse.
                     }, function(error) {
   // The file either could not be read, or could not be saved to Parse.
                    });

                    //user = Parse.User.current();
                    user.set("photo", parseFile);
                    user.set("name", n);
                    user.save(null, {
                    success: function(user) {
                        // Execute any logic that should take place after the object is saved.
                        Redirect();
                                            },
                    error: function(user, error) {
                        // Execute any logic that should take place if the save fails.
                        // error is a Parse.Error with an error code and message.
                        alert('Failed to create new object, with error code: ' + error.id);
                    }
                });                
                }

		});

	</script>

</body>
</html>